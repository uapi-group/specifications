<!doctype html><html lang=en dir=ltr>
<head>
<meta name=generator content="Hugo 0.93.3">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="🔏 Linux TPM PCR Registry 🗒️ #  TPM PCRs are a scarce resource, there are only 24 of them in typical standards compliant TPMs. According to the TCG PC Client Specific Platform Firmware Profile Specification | Trusted Computing Group PCRs 8…15 are for the OS to make use of. In this document we intend to document for Linux platforms which component is using which PCR in order to minimize conflicts.">
<meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Linux TPM PCR Registry">
<meta property="og:description" content="🔏 Linux TPM PCR Registry 🗒️ #  TPM PCRs are a scarce resource, there are only 24 of them in typical standards compliant TPMs. According to the TCG PC Client Specific Platform Firmware Profile Specification | Trusted Computing Group PCRs 8…15 are for the OS to make use of. In this document we intend to document for Linux platforms which component is using which PCR in order to minimize conflicts.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://uapi-group.github.io/specifications/docs/linux_tpm_pcr_registry/"><meta property="article:section" content="docs">
<title>Linux TPM PCR Registry | UAPI group specifications</title><link rel=manifest href=/specifications/manifest.json>
<link rel=icon href=/specifications/favicon.png type=image/x-icon>
<link rel=stylesheet href=/specifications/book.min.68be0b7a9674f2a612ce0e9b2e9447ff4b7ac96546e06b642bfd3ded0ca490ef.css integrity="sha256-aL4LepZ08qYSzg6bLpRH/0t6yWVG4GtkK/097QykkO8=">
<script defer src=/specifications/en.search.min.f0aa39a2830487b72297763eebface0c097dfda5fa9f8a9086366e90b67fcee2.js integrity="sha256-8Ko5ooMEh7cil3Y+6/rODAl9/aX6n4qQhjZukLZ/zuI="></script>
</head><body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a href=/specifications><span>UAPI group specifications</span>
</a>
</h2><div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul>
<li>
<a href=https://uapi-group.github.io/specifications/docs/base_directory_specification/>Base Directory Specification</a>
</li><li>
<a href=https://uapi-group.github.io/specifications/docs/boot_loader_specification/>Boot Loader Specification</a>
</li><li>
<a href=https://uapi-group.github.io/specifications/docs/discoverable_partitions_specification/>Discoverable Partitions Specification</a>
</li><li>
<a href=https://uapi-group.github.io/specifications/docs/linux_tpm_pcr_registry/ class=active>Linux TPM PCR Registry</a>
</li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div></aside><div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/specifications/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Linux TPM PCR Registry</strong>
<label for=toc-control>
<img src=/specifications/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div><aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#sources>Sources</a></li></ul></nav></aside></header><article class=markdown><h1 id=-linux-tpm-pcr-registry->
🔏 Linux TPM PCR Registry 🗒️
<a class=anchor href=#-linux-tpm-pcr-registry->#</a>
</h1><p><em>TPM PCRs are a scarce resource, there are only 24 of them in typical standards compliant TPMs. According to the <a href=https://trustedcomputinggroup.org/resource/pc-client-specific-platform-firmware-profile-specification/>TCG PC Client Specific Platform Firmware Profile Specification | Trusted Computing Group</a> PCRs 8…15 are for the OS to make use of. In this document we intend to document for Linux platforms which component is using which PCR in order to minimize conflicts.</em></p><p>Out of scope for this is how other OSes, in particular Windows’ use the PCRs. Also out of scope are PCRs owned by the firmware, i.e. 0&mldr;7.</p><p>This document is informational in nature: it just describes what is, it is not intended to formally declare “ownership” of a specific PCR, but simply is supposed to reflect which PCR assignments are common in the Linux ecosystems. That said, co-opting PCR usage will likely create problems down the line, in particular if measurement logs are maintained separately. (To be more explicit: on <code>systemd</code> systems the warranty is voided if you write to the PCRs it also uses, as per the list below.)</p><p>PCR measurements most commonly serve two distinct purposes:</p><ul>
<li>To implement access policy on TPM sealed objects: policy can dictate that unsealing of such objects shall only be allowed if some PCRs are in a specific literal state, or in any state for which a signature by a specific key pair can be provided. For this it is essential that PCRs only contain measurements for a clearly defined set of objects, that typically is known in advance so that the PCR value can be pre-calculated (hence this is in a way a <em>forward</em>-looking use)</li><li>To permit reasoning about the boot process and runtime <em>so far</em>, for example for the purpose of remote attestation. In this case it is not that important what objects are measured as long as a record is kept in a measurement log about what it was. The PCRs are in this case used to validate that log (hence this is in a way a <em>backward</em>-looking use)</li></ul><p>In both cases it is important that data measured into the PCRs is carefully chosen. PCRs that shall be useful for policy binding should only cover data objects known in advance, and thus not contain runtime data that cannot be pre-calculated in advance. PCRs that shall be useful for backward-looking validation should only cover objects that are also written to the appropriate log for the PCR.</p><table style=width:100%;display:block;table-layout:fixed>
<tr>
<th><p style=text-align:right><strong>PCR#</strong></p></th><th><strong>Used by</strong></th><th><strong>From Location</strong></th><th><strong>Measured Objects</strong></th><th><strong>Log</strong></th><th><strong>Use Reported By</strong></th></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>8</strong></p></td><td style=background-color:#aea><code style=background-color:#aea>grub 🍲</code></td><td>UEFI Boot Component</td><td>Commands and kernel command line</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>9</strong></p></td><td style=background-color:#aea><code style=background-color:#aea>grub 🍲</code></td><td>UEFI Boot Component</td><td>All files read (including kernel image)</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>(cont.)</strong></p></td><td style=background-color:#b399c2>Linux kernel 🌰</td><td>Kernel</td><td>All passed initrds (when the new <code>LOAD_FILE2 </code>initrd protocol is used)</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>10</strong></p></td><td style=background-color:#a3c2d4>IMA 📐</td><td>Kernel</td><td>Protection of the IMA measurement log</td><td>IMA event log</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>11</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-stub 🚀</code></td><td>UEFI Stub</td><td>All components of unified kernel images (UKIs)</td><td>UEFI TPM event log</td><td>in EFI variable <code>StubPcrKernelImage</code></td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>(cont.)</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-pcrphase 🚀</code></td><td>Userspace</td><td>Boot phase strings, indicating various milestones of the boot process</td><td>Journal (for now)</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>12</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-stub 🚀</code></td><td>UEFI Stub</td><td>Kernel command line, system credentials and system configuration images</td><td>UEFI TPM event log</td><td>in EFI variable <code>StubPcrKernelParameters</code></td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>13</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-stub 🚀</code></td><td>UEFI Stub</td><td>All system extension images for the initrd</td><td>UEFI TPM event log</td><td>in EFI variable <code>StubPcrInitRDSysExts</code></td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>14</strong></p></td><td style=background-color:#f5d97d><code style=background-color:#f5d97d>shim 🔑</code></td><td>UEFI Boot Component</td><td>“MOK” certificates and hashes</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>15</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-cryptsetup@.service 🚀</code></td><td>Userspace</td><td>Root file system volume encryption key</td><td>Journal (for now)</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong> (cont.)</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-pcrmachine.service 🚀</code></td><td>Userspace</td><td>Machine ID (<code>/etc/machine-id</code>)</td><td>Journal (for now)</td><td>n/a</td></tr><tr>
<td style=background-color:#fff3bf><p style=text-align:right><strong>(cont.)</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-pcrfs@.service 🚀</code></td><td>Userspace</td><td>File system mount point, UUID, label, partition UUID label of root file system and <code>/var/</code></td><td>Journal (for now)</td><td>n/a</td></tr></table><p>Note that PCR 11 and 15 as shown in the list above are used by multiple components of systemd. These are not conflicting uses, but the involved components are properly ordered to guarantee cooperative, strictly predictable behaviour.</p><h2 id=sources>
Sources
<a class=anchor href=#sources>#</a>
</h2><ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd-cryptenroll.html#--tpm2-pcrs=PCR">systemd-cryptenroll(1)</a></li><li><a href=https://trustedcomputinggroup.org/resource/pc-client-specific-platform-firmware-profile-specification/>TCG PC Client Specific Platform Firmware Profile Specification</a></li><li><a href=https://github.com/rhboot/shim/blob/main/README.tpm>shim&rsquo;s README.tpm</a></li><li><a href=https://www.gnu.org/software/grub/manual/grub/html_node/Measured-Boot.html>Measured Boot - GNU GRUB Manual 2.06</a></li><li><a href=https://sourceforge.net/p/linux-ima/wiki/Home/>Integrity Measurement Architecture (IMA)</a></li><li><a href=https://github.com/tianocore-docs/edk2-TrustedBootChain/blob/main/4_Other_Trusted_Boot_Chains.md>edk2-TrustedBootChain/4_Other_Trusted_Boot_Chains.md</a></li><li><a href=https://wiki.archlinux.org/title/Trusted_Platform_Module#Accessing_PCR_registers>Trusted Platform Module - ArchWiki</a></li></ul></article><footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div></footer><div class=book-comments>
</div><label for=menu-control class="hidden book-menu-overlay"></label>
</div><aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#sources>Sources</a></li></ul></nav></div></aside></main></body></html>