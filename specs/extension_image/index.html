<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.104.3"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Extension Images # Extension Images are DDIs ( Discoverable Disk Images) that are built to extend a base system via an overlay. A base system or a root DDI can be extended by several extension DDIs via, usually, a read-only OverlayFS. The defining characteristic of an Extension Image is that it contains an extension-release.<IMAGE> file that identifies itself and the base system or root DDI it applies to, and must not contain an os-release file."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Extension Images"><meta property="og:description" content="Extension Images # Extension Images are DDIs ( Discoverable Disk Images) that are built to extend a base system via an overlay. A base system or a root DDI can be extended by several extension DDIs via, usually, a read-only OverlayFS. The defining characteristic of an Extension Image is that it contains an extension-release.<IMAGE> file that identifies itself and the base system or root DDI it applies to, and must not contain an os-release file."><meta property="og:type" content="article"><meta property="og:url" content="https://uapi-group.org/specifications/specs/extension_image/"><meta property="article:section" content="specs"><title>Extension Images | UAPI Group Specifications</title><link rel=manifest href=/specifications/manifest.json><link rel=icon href=/specifications/favicon.png type=image/x-icon><link rel=stylesheet href=/specifications/book.min.f716a89e40b01f033146ee402497165ac5bcf8935948094dceafbcb19f6f3c8d.css integrity="sha256-9xaonkCwHwMxRu5AJJcWWsW8+JNZSAlNzq+8sZ9vPI0="><script defer src=/specifications/en.search.min.b45833736799bc5959d4baa4db7830c81f0859ce6a6c70310595631aba50c4d2.js integrity="sha256-tFgzc2eZvFlZ1Lqk23gwyB8IWc5qbHAxBZVjGrpQxNI="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/specifications><span>UAPI Group Specifications</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://uapi-group.org/>⬅️ Back to top</a></li><li>⸻</li></ul><ul><li><span>Specs</span><ul><li><a href=https://uapi-group.org/specifications/specs/sysext/>Sysext</a></li><li><a href=https://uapi-group.org/specifications/specs/boot_loader_specification/>Boot Loader Specification</a></li><li><a href=https://uapi-group.org/specifications/specs/configuration_files_specification/>Configuration Files Specification</a></li><li><a href=https://uapi-group.org/specifications/specs/discoverable_disk_image/>Discoverable Disk Image</a></li><li><a href=https://uapi-group.org/specifications/specs/discoverable_partitions_specification/>Discoverable Partitions Specification</a></li><li><a href=https://uapi-group.org/specifications/specs/extension_image/ class=active>Extension Images</a></li><li><a href=https://uapi-group.org/specifications/specs/file_hierarchy_for_the_verification_of_os_artifacts/>File Hierarchy for the Verification of OS Artifacts (VOA)</a></li><li><a href=https://uapi-group.org/specifications/specs/linux_file_system_hierarchy/>Linux File System Hierarchy</a></li><li><a href=https://uapi-group.org/specifications/specs/linux_tpm_pcr_registry/>Linux TPM PCR Registry</a></li><li><a href=https://uapi-group.org/specifications/specs/unified_kernel_image/>Unified Kernel Image</a></li><li><a href=https://uapi-group.org/specifications/specs/version_format_specification/>Version Format Specification</a></li></ul></li></ul><ul><li>⸻</li><li><a href=https://github.com/uapi-group/specifications target=_blank rel=noopener>Collaborate on Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/specifications/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Extension Images</strong>
<label for=toc-control><img src=/specifications/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ordering>Ordering</a></li><li><a href=#image-format>Image Format</a></li><li><a href=#extension-types>Extension Types</a><ul><li><a href=#sysext-system-extension>sysext (System Extension)</a></li><li><a href=#confext-configuration-extension>confext (Configuration Extension)</a></li></ul></li><li><a href=#base-directory-immutability--mutability>Base Directory Immutability / Mutability</a><ul><li><a href=#optional-mutability>Optional Mutability</a></li><li><a href=#extension-overlay-immutability-modes>Extension Overlay [Im]Mutability Modes</a></li><li><a href=#mutability-mode-configuration>Mutability Mode Configuration</a></li></ul></li><li><a href=#file-suffix>File Suffix</a></li><li><a href=#identification>Identification</a><ul><li><a href=#fields-in-extension-release--matching-with-the-base-system-or-ddi>Fields in extension-release — Matching with the base system or DDI</a></li><li><a href=#fields-in-extension-release--identifying-the-extension-image>Fields in extension-release — Identifying the Extension Image</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=extension-images>Extension Images
<a class=anchor href=#extension-images>#</a></h1><p>Extension Images are DDIs (
<a href=/specifications/specs/discoverable_disk_image/>Discoverable Disk Images</a>) that are
built to extend a base system via an overlay. A base system or a root DDI can be extended by several extension
DDIs via, usually, a read-only OverlayFS. The defining characteristic of an Extension Image is that it contains
an <code>extension-release.&lt;IMAGE></code> file that identifies itself and the base system or root DDI it applies to,
and must not contain an <code>os-release</code> file.</p><h2 id=ordering>Ordering
<a class=anchor href=#ordering>#</a></h2><p>The default order in which extensions are applied is based on lexicographic sorting as
<a href=/specifications/specs/version_format_specification/>defined in the Version Format Specification</a>, with images sorting as
older being placed lower in the overlay. Implementations may allow a different order to be explicitly
specified instead.</p><h2 id=image-format>Image Format
<a class=anchor href=#image-format>#</a></h2><p>Extensions are DDIs (
<a href=/specifications/specs/discoverable_disk_image/>Discoverable Disk Images</a>), so the file format will not be
redefined here.</p><h2 id=extension-types>Extension Types
<a class=anchor href=#extension-types>#</a></h2><p>There are two types of extension images, sysext (System Extension) and confext (Configuration Extension).
They are differentiated by the directory hierarchies they contain.</p><h3 id=sysext-system-extension>sysext (System Extension)
<a class=anchor href=#sysext-system-extension>#</a></h3><p>sysext images extend <code>/usr/</code> (OS vendor tree) and/or <code>/opt/</code> (third-party vendor tree). They must contain a
<code>/usr/lib/extension-release.d/extension-release.&lt;IMAGE></code> file to identify them.</p><h3 id=confext-configuration-extension>confext (Configuration Extension)
<a class=anchor href=#confext-configuration-extension>#</a></h3><p>confext images extend <code>/etc</code>. They must contain a <code>/etc/extension-release.d/extension-release.&lt;IMAGE></code> file
to identify them.</p><h2 id=image-content>Image Content</h2>Extension Images should be additive, and not override content present in the base image or other DDIs.
However, there currently is no safe and efficient way to detect collisions and to enforce content uniqueness
across the stack of images.
In a future version of this specification options for enforcing uniqueness may be provided.<h2 id=base-directory-immutability--mutability>Base Directory Immutability / Mutability
<a class=anchor href=#base-directory-immutability--mutability>#</a></h2><p>By default, applying (&ldquo;merging&rdquo;) an Extension Image on a mutable filesystem renders the underlying base
directory (<code>/etc/</code>, <code>/usr/</code>, <code>/opt/</code>) immutable.
By implication, merging a confext on a mutable filesystem will result in <code>/etc/</code> becoming read-only, and
merging a sysext might render <code>/usr/</code> and/or <code>/opt/</code> read-only, depending on the sysext&rsquo;s contents.</p><p>This affects base directories actually contained in extensions merged to a root filesystem:
for instance, if a sysext extends <code>/usr/</code> but not <code>/opt/</code>, <code>/opt/</code> will remain mutable if
it&rsquo;s on a mutable filesystem.
However, immutability affects the <em>full</em> base directory.
Merging an extension on a mutable filesystem that ships a single custom path e.g. below
<code>/etc/appconfig-extra/some/sub/path/</code> will still render the entirety of <code>/etc/</code> immutable.
The base directory or directories remain immutable for as long as extensions are merged.
Mutability, if present before the merge, is regained only after all extensions overlaying a base directory
have been un-merged.</p><h3 id=optional-mutability>Optional Mutability
<a class=anchor href=#optional-mutability>#</a></h3><p>While overlaid base directories are immutable by default, implementations may provide options
for mutability.
Retaining mutability may for instance be useful for compatibility with general purpose applications,
enabling users to operate a &ldquo;mixed mode&rdquo; with both system and configuration extensions
and traditional applications.
Mixed mode may also be integrated by distributions to facilitate a smooth transition from
traditional package management to a purely image-based composition of the root file system.
Lastly, mutability mode may be used on an originally immutable filesystem to allow and to capture
temporary changes.</p><h3 id=extension-overlay-immutability-modes>Extension Overlay [Im]Mutability Modes
<a class=anchor href=#extension-overlay-immutability-modes>#</a></h3><p>System and configuration extensions may operate in one of three modes.</p><ol><li><em>Immutable mode</em> - The overlaid base directory is immutable.
This is the default.</li><li><em>Mutable mode</em> - Writes are directed to an <em>upperdir</em> specified by the user or operator
(see &ldquo;Mutability Mode Configuration&rdquo; below).
This <em>upperdir</em> will contain all changes made to the overlaid base directory.<ol><li><em>Upperdir</em> may be specified to <em>be</em> the base directory: may be used to retain mutability
of the base directory after extensions have been merged.</li><li>Alternatively, <em>upperdir</em> may be an entirely separate directory: modifications will be captured
but the base directory will remain unchanged, retaining its state from before the extension was merged.</li></ol></li><li><em>Ephemeral Mode</em> - Similar to mutable mode (2.) above but writes are only stored temporarily while
extensions are merged, and discarded as soon as extensions are un-merged.
Location of temporary storage is implementation-specific.
Useful for e.g. development and for one-shot validation operations.</li></ol><h3 id=mutability-mode-configuration>Mutability Mode Configuration
<a class=anchor href=#mutability-mode-configuration>#</a></h3><p>Immutable mode is the default.
If none of the configurations outlined below were specified then extension overlays operate
in immutable mode and base directories are read-only.
Implementation of any of the below mutable configurations is optional.
<em>If</em> mutable modes are supported by an implementation, configuration option 1. below <em>must</em> be supported
for compatibility across implementations.</p><p>Mutability modes may be configured in the following ways:</p><ol><li>By creating qualified paths or soft-links below <code>/var/lib/extensions.mutable/</code>.
See &ldquo;Qualified Paths Definition&rdquo; below for details.
This is the most portable option across different implementations.
If an implementation supports base directory mutability then this mode <em>must</em> be supported.</li><li>By setting a respective option in an implementation&rsquo;s configuration file.
This option is implementation-specific.
Implementations may choose to support a single option, multiple options for
system and configuration extensions, and/or multiple options per base directory.
Using this option should selectively override any qualified path definitions from 1.</li><li>By passing a command line parameter upon extension merge or refresh.
This option is implementation-specific.
Implementations may choose to support a single option and/or multiple options per base directory.
Using this option should selectively override any configurations from 1. and 2.</li></ol><h4 id=qualified-paths-definition>Qualified Paths Definition
<a class=anchor href=#qualified-paths-definition>#</a></h4><p>Mutability Mode 1 enables mutability by creating paths or soft-links below
<code>/var/lib/extensions.mutable/</code>.
Qualified paths are:</p><ul><li><code>/var/lib/extensions.mutable/etc/</code> - directory or soft-link to a directory to store writes to
<code>/etc/</code>. This is for configuration extensions.</li><li><code>/var/lib/extensions.mutable/usr/</code> - directory or soft-link to a directory to store writes to
<code>/usr/</code>. This is for system extensions.</li><li><code>/var/lib/extensions.mutable/opt/</code> - directory or soft-link to a directory to store writes to
<code>/opt/</code>. This is for system extensions.</li></ul><p>Each base directory is treated separately.
The existence and the type of each qualified path determines the mutability mode used.
The following mutability modes are supported:</p><ul><li><em>Path does not exist</em> - immutable mode.</li><li>Path is a <em>directory, subvolume, or mount point</em> - the path at
<code>/var/lib/extensions.mutable/&lt;basedir>/</code> is used to store writes to <code>/&lt;basedir>/</code>.<ul><li>A tmpfs mount at the qualified path may be used for a custom ephemeral mode.
In this case, clean-up of the tmpfs is left to the user and/or is implementation-specific.</li></ul></li><li>Path is a <em>soft link</em> - the soft link is followed and writes are stored at the link&rsquo;s destination.<ul><li>If the destination is the base directory - i.e. <code>/var/lib/extensions.mutable/&lt;basedir>/</code>
points to <code>/&lt;basedir>/</code> - then the stacking order changes and <code>&lt;basedir></code> becomes <em>upperdir</em>.
Writes are directed to the base directory and files and paths present in the base directory
override files and paths in extensions if present.</li><li>The soft link may point to a tmpfs destination for custom ephemeral mode.
In this case, clean-up of the tmpfs is left to the user and/or is implementation-specific.</li><li>If the destination does not exist, immutable mode is used.</li></ul></li></ul><h2 id=file-suffix>File Suffix
<a class=anchor href=#file-suffix>#</a></h2><p>Since extensions images are DDIs, they should carry the <code>.raw</code> suffix. In order to make discerning system
extensions and configuration extensions easy it is recommended to use the <code>.sysext.raw</code> suffix for system
extensions, and <code>.confext.raw</code> for configuration extensions.</p><h2 id=identification>Identification
<a class=anchor href=#identification>#</a></h2><p>An Extension Image must contain a <code>extension-release.&lt;IMAGE></code> file, where <code>&lt;IMAGE></code> must either match the
name of the sysext minus the suffix, or alternatively <code>extension-release.&lt;IMAGE></code> must be tagged with a
<code>user.extension-release.strict</code> xattr set to the string <code>"0"</code> in order to be valid. This is to make it
obvious to users that a sysext is used for its purpose.
The format of <code>extension-release.&lt;IMAGE></code> is the same as the
<a href=https://www.freedesktop.org/software/systemd/man/os-release.html><code>os-release</code> file</a>, and it is a
newline-separated list of environment-like shell-compatible variable assignments. New fields
<code>SYSEXT_LEVEL=</code> and <code>CONFEXT_LEVEL=</code> have been introduced to allow an implementation to match a sysext or
a confext with the base image upon which it is layered: if the field is present, it must match between the
layers or the Extension Image must be ignored, while if it is not present, but <code>VERSION_ID=</code> is, then the
latter must match instead.
In addition, the <code>ID=</code> field must be present and match the base image&rsquo;s, or be set to the special value
<code>_any</code>, in case the Extension Image can be used on any Linux distribution.</p><h3 id=fields-in-extension-release--matching-with-the-base-system-or-ddi>Fields in extension-release — Matching with the base system or DDI
<a class=anchor href=#fields-in-extension-release--matching-with-the-base-system-or-ddi>#</a></h3><p>The following fields are used in order to match with the base system or DDI.</p><h4 id=sysext_level-confext_level><code>SYSEXT_LEVEL=</code> <code>CONFEXT_LEVEL=</code>
<a class=anchor href=#sysext_level-confext_level>#</a></h4><p>A lower-case string (mostly numeric, no spaces or other characters outside of 0–9, a–z, &ldquo;.&rdquo;, &ldquo;_&rdquo; and
&ldquo;-&rdquo;) identifying the operating system extensions support level, to indicate which extension images are
supported.</p><p>Examples: <code>"SYSEXT_LEVEL=2"</code>, <code>"CONFEXT_LEVEL=15.14"</code>.</p><p>If not present, and if <code>VERSION_ID=</code> is present instead, then this will be checked instead.</p><h4 id=version_id-id-architecture><code>VERSION_ID=</code>, <code>ID=</code>, <code>ARCHITECTURE=</code>
<a class=anchor href=#version_id-id-architecture>#</a></h4><p><code>VERSION_ID=</code> and <code>ID=</code> are used to match the Extension Image with the root DDI, and <code>ARCHITECTURE=</code> is used
to match with the host&rsquo;s CPU architecture, as defined in the
<a href=https://www.freedesktop.org/software/systemd/man/os-release.html><code>os-release</code> specification</a>.
<code>ID=</code> and <code>ARCHITECTURE=</code> also support specifying the <code>_any</code> wildcard, which allows the matching mechanism
to be bypassed.</p><h3 id=fields-in-extension-release--identifying-the-extension-image>Fields in extension-release — Identifying the Extension Image
<a class=anchor href=#fields-in-extension-release--identifying-the-extension-image>#</a></h3><p>The identification fields defined in the
<a href=https://www.freedesktop.org/software/systemd/man/os-release.html><code>os-release</code> specification</a>
can be used to also identify the sysext itself, by prefixing them with <code>SYSEXT_</code>. For example,
<code>SYSEXT_ID=myext</code> <code>SYSEXT_VERSION_ID=0.1</code> denotes a &lsquo;myext&rsquo; sysext of version &lsquo;0.1&rsquo;.
There are also extension-specific fields that do not apply to &lsquo;os-release&rsquo;, <code>SYSEXT_SCOPE=</code>,
<code>CONFEXT_SCOPE=</code> and <code>ARCHITECTURE=</code>.</p><h4 id=sysext_scope-confext_scope><code>SYSEXT_SCOPE=</code>, <code>CONFEXT_SCOPE=</code>
<a class=anchor href=#sysext_scope-confext_scope>#</a></h4><p>Takes a space-separated list of one or more of the strings <code>"system"</code>, <code>"initrd"</code> and <code>"portable"</code>. This field
is optional and indicates what environments the system extension is applicable to: i.e. to regular systems,
to initrds, or to
<a href=https://systemd.io/PORTABLE_SERVICES/>portable service images</a>. If unspecified,
<code>"SYSEXT_SCOPE=system portable"</code> is implied, i.e. any system extension without this field is applicable to
regular systems and to portable service environments, but not to initrd environments.</p><h4 id=architecture><code>ARCHITECTURE=</code>
<a class=anchor href=#architecture>#</a></h4><p>A string that specifies which CPU architecture the userspace binaries require. This field is optional
and should only be used when just single architecture is supported. It may provide redundant
information when used in a GPT partition with a GUID type that already encodes the architecture. If this
is not the case, the architecture should be specified in e.g., an extension image, to prevent an
incompatible host from loading it.</p><p>Valid values:</p><table><thead><tr><th>Architecture</th></tr></thead><tbody><tr><td>x86</td></tr><tr><td>x86-64</td></tr><tr><td>alpha</td></tr><tr><td>arc</td></tr><tr><td>arc-be</td></tr><tr><td>arm</td></tr><tr><td>arm-be</td></tr><tr><td>arm64</td></tr><tr><td>arm64-be</td></tr><tr><td>cris</td></tr><tr><td>ia64</td></tr><tr><td>loongarch64</td></tr><tr><td>m68k</td></tr><tr><td>mips</td></tr><tr><td>mips-le</td></tr><tr><td>mips64</td></tr><tr><td>mips64-le</td></tr><tr><td>parisc</td></tr><tr><td>parisc64</td></tr><tr><td>ppc</td></tr><tr><td>ppc-le</td></tr><tr><td>ppc64</td></tr><tr><td>ppc64-le</td></tr><tr><td>riscv32</td></tr><tr><td>riscv64</td></tr><tr><td>s390</td></tr><tr><td>s390x</td></tr><tr><td>sh</td></tr><tr><td>sh64</td></tr><tr><td>sparc64</td></tr><tr><td>sparc</td></tr><tr><td>tilegx</td></tr><tr><td>native</td></tr><tr><td>any</td></tr></tbody></table></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/uapi-group/specifications/edit/main/specs/extension_image.md target=_blank rel=noopener><img src=/specifications/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#ordering>Ordering</a></li><li><a href=#image-format>Image Format</a></li><li><a href=#extension-types>Extension Types</a><ul><li><a href=#sysext-system-extension>sysext (System Extension)</a></li><li><a href=#confext-configuration-extension>confext (Configuration Extension)</a></li></ul></li><li><a href=#base-directory-immutability--mutability>Base Directory Immutability / Mutability</a><ul><li><a href=#optional-mutability>Optional Mutability</a></li><li><a href=#extension-overlay-immutability-modes>Extension Overlay [Im]Mutability Modes</a></li><li><a href=#mutability-mode-configuration>Mutability Mode Configuration</a></li></ul></li><li><a href=#file-suffix>File Suffix</a></li><li><a href=#identification>Identification</a><ul><li><a href=#fields-in-extension-release--matching-with-the-base-system-or-ddi>Fields in extension-release — Matching with the base system or DDI</a></li><li><a href=#fields-in-extension-release--identifying-the-extension-image>Fields in extension-release — Identifying the Extension Image</a></li></ul></li></ul></nav></div></aside></main></body></html>