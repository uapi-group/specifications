<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="UAPI.14 VMGenID: Virtual Machine Generation ID# Version Changes 1.0 Initial Release Virtual machine operations that restore a VM to an earlier point in time (such as applying snapshots, restoring from backup, cloning, or failover scenarios) can cause serious problems for applications that depend on unique identifiers or cryptographic entropy. The Virtual Machine Generation ID (VMGenID) device provides a mechanism for guest software to detect when such operations have occurred.
The VMGenID is a 128-bit cryptographically random identifier that changes whenever a virtual machine is cloned or restored to an earlier state. This allows applications to detect such events and take appropriate protective measures, such as reseeding random number generators, regenerating unique identifiers, or invalidating cached state.
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://uapi-group.org/specifications/specs/vmgenid/"><meta property="og:site_name" content="UAPI Group Specifications"><meta property="og:title" content="UAPI.14 VMGenID"><meta property="og:description" content="UAPI.14 VMGenID: Virtual Machine Generation ID# Version Changes 1.0 Initial Release Virtual machine operations that restore a VM to an earlier point in time (such as applying snapshots, restoring from backup, cloning, or failover scenarios) can cause serious problems for applications that depend on unique identifiers or cryptographic entropy. The Virtual Machine Generation ID (VMGenID) device provides a mechanism for guest software to detect when such operations have occurred.
The VMGenID is a 128-bit cryptographically random identifier that changes whenever a virtual machine is cloned or restored to an earlier state. This allows applications to detect such events and take appropriate protective measures, such as reseeding random number generators, regenerating unique identifiers, or invalidating cached state."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="specs"><meta itemprop=name content="UAPI.14 VMGenID"><meta itemprop=description content="UAPI.14 VMGenID: Virtual Machine Generation ID# Version Changes 1.0 Initial Release Virtual machine operations that restore a VM to an earlier point in time (such as applying snapshots, restoring from backup, cloning, or failover scenarios) can cause serious problems for applications that depend on unique identifiers or cryptographic entropy. The Virtual Machine Generation ID (VMGenID) device provides a mechanism for guest software to detect when such operations have occurred.
The VMGenID is a 128-bit cryptographically random identifier that changes whenever a virtual machine is cloned or restored to an earlier state. This allows applications to detect such events and take appropriate protective measures, such as reseeding random number generators, regenerating unique identifiers, or invalidating cached state."><meta itemprop=wordCount content="710"><title>UAPI.14 VMGenID | UAPI Group Specifications</title><link rel=icon href=/specifications/favicon.png><link rel=manifest href=/specifications/manifest.json><link rel=canonical href=https://uapi-group.org/specifications/specs/vmgenid/><link rel=stylesheet href=/specifications/book.min.6e0e4905af9f431e4a07d14b16ee4d5d1e90da19ad2b6d9d1d2aa2da9757473d.css integrity="sha256-bg5JBa+fQx5KB9FLFu5NXR6Q2hmtK22dHSqi2pdXRz0=" crossorigin=anonymous><script defer src=/specifications/fuse.min.js></script><script defer src=/specifications/en.search.min.be5215689e749d75b590d2a64f122aa0b6e9bbcae69b23f0189eac61dd217537.js integrity="sha256-vlIVaJ50nXW1kNKmTxIqoLbpu8rmmyPwGJ6sYd0hdTc=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-specs book-layout-default"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/specifications/><span>UAPI Group Specifications</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/>⬅️ Back to top</a></li></ul><ul><li><a>Specifications</a><ul><li><a href=/specifications/specs/boot_loader_specification/>UAPI.1 Boot Loader Specification</a></li><li><a href=/specifications/specs/discoverable_partitions_specification/>UAPI.2 Discoverable Partitions Specification</a></li><li><a href=/specifications/specs/discoverable_disk_image/>UAPI.3 Discoverable Disk Images</a></li><li><a href=/specifications/specs/extension_image/>UAPI.4 Extension Images</a></li><li><a href=/specifications/specs/unified_kernel_image/>UAPI.5 Unified Kernel Images</a></li><li><a href=/specifications/specs/configuration_files_specification/>UAPI.6 Configuration Files Specification</a></li><li><a href=/specifications/specs/linux_tpm_pcr_registry/>UAPI.7 Linux TPM PCR Registry</a></li><li><a href=/specifications/specs/package_metadata_for_executable_files/>UAPI.8 Package Metadata for Executable Files</a></li><li><a href=/specifications/specs/linux_file_system_hierarchy/>UAPI.9 Linux File System Hierarchy</a></li><li><a href=/specifications/specs/version_format_specification/>UAPI.10 Version Format Specification</a></li><li><a href=/specifications/specs/file_hierarchy_for_the_verification_of_os_artifacts/>UAPI.11 File Hierarchy for the Verification of OS Artifacts (VOA)</a></li><li><a href=/specifications/specs/elf_dlopen_metadata/>UAPI.12 dlopen() Metadata for ELF Files</a></li><li><a href=/specifications/specs/vmclock/>UAPI.13 VMClock</a></li><li><a href=/specifications/specs/vmgenid/ class=active>UAPI.14 VMGenID</a></li><li><a href=/specifications/specs/osc_context/>UAPI.15 OSC 3008: Hierarchical Context Signalling</a></li></ul></li></ul><ul><li><a href=https://github.com/uapi-group/specifications target=_blank rel=noopener>Collaborate on Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/specifications/icons/menu.svg class=book-icon alt=Menu></label><h3>UAPI.14 VMGenID</h3><label for=toc-control><img src=/specifications/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#the-vmgenid_abi-structure>The vmgenid_abi Structure</a><ul><li><a href=#structure-fields>Structure Fields</a></li><li><a href=#guid-interoperability>GUID interoperability</a></li></ul></li><li><a href=#discovery-via-acpi>Discovery via ACPI</a></li><li><a href=#discovery-via-device-tree>Discovery via Device Tree</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=uapi14-vmgenid-virtual-machine-generation-id>UAPI.14 VMGenID: Virtual Machine Generation ID<a class=anchor href=#uapi14-vmgenid-virtual-machine-generation-id>#</a></h1><table><thead><tr><th>Version</th><th>Changes</th></tr></thead><tbody><tr><td>1.0</td><td>Initial Release</td></tr></tbody></table><p>Virtual machine operations that restore a VM to an earlier point in time (such as applying snapshots, restoring from backup, cloning, or failover scenarios) can cause serious problems for applications that depend on unique identifiers or cryptographic entropy. The Virtual Machine Generation ID (VMGenID) device provides a mechanism for guest software to detect when such operations have occurred.</p><p>The VMGenID is a 128-bit cryptographically random identifier that changes whenever a virtual machine is cloned or restored to an earlier state. This allows applications to detect such events and take appropriate protective measures, such as reseeding random number generators, regenerating unique identifiers, or invalidating cached state.</p><h2 id=the-vmgenid_abi-structure>The vmgenid_abi Structure<a class=anchor href=#the-vmgenid_abi-structure>#</a></h2><p>The hypervisor provides 16 bytes in shared memory containing the generation ID. The structure can be represented as two little-endian 64-bit values, and must be placed in an 8-byte aligned buffer.</p><h3 id=structure-fields>Structure Fields<a class=anchor href=#structure-fields>#</a></h3><table><thead><tr><th>Offset</th><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>0x00</td><td><code>uint64_t generation_id_low</code></td><td>Lower 64 bits of the 128-bit generation ID</td></tr><tr><td>0x08</td><td><code>uint64_t generation_id_high</code></td><td>Upper 64 bits of the 128-bit generation ID</td></tr></tbody></table><p>The generation ID is a 128-bit cryptographically random value that is unique across all VM instances and time. All 128 bits are random; it is <em>not</em> a Version 4 UUID.</p><p>The generation ID changes whenever the VM is restored to an earlier or non-unique state:</p><ul><li>Snapshot restoration</li><li>Backup recovery</li><li>VM cloning/copying/import</li><li>Disaster recovery failover</li></ul><p>The generation ID remains constant during normal VM operations:</p><ul><li>Pause/resume</li><li>Shutdown/restart/reboot</li><li>Host reboot or upgrade</li><li>Live migration or lossless online failover</li></ul><p>Events, such as live migrations, which merely disrupt the VM&rsquo;s clock without changing the uniqueness of its identity do not result in a change to the generation ID. Conversely, cloning (forking) a running VM running on the same host would result in a new generation ID without disrupting the timekeeping. Guests which want to detect clock disruption should use the <a href=/specifications/specs/vmclock/>VMClock device</a> for that purpose.</p><h3 id=guid-interoperability>GUID interoperability<a class=anchor href=#guid-interoperability>#</a></h3><p>If the generation ID is represented as a GUID for the purpose of storage or configuration by a Virtual Machine Monitor, it is recommended that:</p><ul><li>The generation ID shared to the guest is the little-endian representation of that GUID</li><li>The textual representation of the GUID, in display or configuration, is the RFC 4122 standard big-endian form</li></ul><h2 id=discovery-via-acpi>Discovery via ACPI<a class=anchor href=#discovery-via-acpi>#</a></h2><p>To expose VMGenID to the operating system via ACPI, the firmware or hypervisor must:</p><ol><li><p>Place the shared <code>vmgenid_abi</code> structure somewhere in RAM, ROM or device memory space, which is guaranteed not to be used by the operating system. It must not be in ranges reported as <code>AddressRangeMemory</code> or <code>AddressRangeACPI</code>, and must not be in the same page as any memory which is expected to be mapped by a page table entry with caching disabled.</p></li><li><p>Expose a device somewhere in the ACPI namespace with:</p><ul><li>a hardware ID (<code>_HID</code>) that is hypervisor-specific</li><li>a DOS Device Name ID (<code>_DDN</code>) of &ldquo;VM_Gen_Counter&rdquo;</li><li>a compatible ID (<code>_CID</code>) of &ldquo;VM_Gen_Counter&rdquo;</li></ul></li><li><p>Attach to the device an <code>ADDR</code> method which when evaluated returns the 64-bit physical address of the generation ID structure as a package containing the low and high 32-bit address components in that order.</p></li><li><p>After the generation ID changes, the device shall raise an ACPI Notify operation using notification code 0x80. The device may raise the notify operation even if the generation ID has not changed.</p></li></ol><h2 id=discovery-via-device-tree>Discovery via Device Tree<a class=anchor href=#discovery-via-device-tree>#</a></h2><p>The firmware or hypervisor must place the <code>vmgenid_abi</code> structure in an otherwise unused region of physical memory and advertise its presence to the operating system. The Device Tree binding for the <code>microsoft,vmgenid</code> node is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>%YAML 1.2</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>$id</span>: <span style=color:#ae81ff>http://devicetree.org/schemas/rng/microsoft,vmgenid.yaml#</span>
</span></span><span style=display:flex><span><span style=color:#f92672>$schema</span>: <span style=color:#ae81ff>http://devicetree.org/meta-schemas/core.yaml#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>title</span>: <span style=color:#ae81ff>Virtual Machine Generation ID</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>maintainers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Jason A. Donenfeld &lt;Jason@zx2c4.com&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>Firmwares or hypervisors can use this devicetree to describe an</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>interrupt and a shared resource to inject a Virtual Machine Generation ID.</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>Virtual Machine Generation ID is a globally unique identifier (GUID) and</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>the devicetree binding follows VMGenID specification.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>properties</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>compatible</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>const</span>: <span style=color:#ae81ff>microsoft,vmgenid</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reg</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>:
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>Specifies a 16-byte VMGenID in endianness-agnostic hexadecimal format.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>maxItems</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>interrupts</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>:
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>Interrupt used to notify that a new VMGenID is available.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>maxItems</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>required</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>compatible</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>reg</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>interrupts</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>additionalProperties</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>examples</span>:
</span></span><span style=display:flex><span>  - |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    #include &lt;dt-bindings/interrupt-controller/arm-gic.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    rng@80000000 {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      compatible = &#34;microsoft,vmgenid&#34;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      reg = &lt;0x80000000 0x1000&gt;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      interrupts = &lt;GIC_SPI 35 IRQ_TYPE_EDGE_RISING&gt;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    };</span></span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div><a class="flex align-center" href=https://github.com/uapi-group/specifications/edit/main/specs/vmgenid.md target=_blank rel="noopener edit"><img src=/specifications/icons/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><div class="flex flex-wrap justify-between"><span><a href=/specifications/specs/vmclock/ class="flex align-center"><img src=/specifications/icons/backward.svg class=book-icon alt=Backward>
<span>UAPI.13 VMClock</span>
</a></span><span><a href=/specifications/specs/osc_context/ class="flex align-center"><span>UAPI.15 OSC 3008: Hierarchical Context Signalling</span>
<img src=/specifications/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class=book-comments></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#the-vmgenid_abi-structure>The vmgenid_abi Structure</a><ul><li><a href=#structure-fields>Structure Fields</a></li><li><a href=#guid-interoperability>GUID interoperability</a></li></ul></li><li><a href=#discovery-via-acpi>Discovery via ACPI</a></li><li><a href=#discovery-via-device-tree>Discovery via Device Tree</a></li></ul></nav></div></aside></main></body></html>