<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.104.3"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="üîè Linux TPM PCR Registry üóíÔ∏è # TPM PCRs are a scarce resource, there are only 24 of them in typical standards compliant TPMs. According to the TCG PC Client Specific Platform Firmware Profile Specification | Trusted Computing Group the OS can make use of PCRs 8‚Ä¶15. This document lists which component is using which PCR on a Linux platform in order to minimize conflicts.
PCRs owned by the firmware, i."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Linux TPM PCR Registry"><meta property="og:description" content="üîè Linux TPM PCR Registry üóíÔ∏è # TPM PCRs are a scarce resource, there are only 24 of them in typical standards compliant TPMs. According to the TCG PC Client Specific Platform Firmware Profile Specification | Trusted Computing Group the OS can make use of PCRs 8‚Ä¶15. This document lists which component is using which PCR on a Linux platform in order to minimize conflicts.
PCRs owned by the firmware, i."><meta property="og:type" content="article"><meta property="og:url" content="https://uapi-group.org/specifications/specs/linux_tpm_pcr_registry/"><meta property="article:section" content="specs"><title>Linux TPM PCR Registry | UAPI Group Specifications</title><link rel=manifest href=/specifications/manifest.json><link rel=icon href=/specifications/favicon.png type=image/x-icon><link rel=stylesheet href=/specifications/book.min.f716a89e40b01f033146ee402497165ac5bcf8935948094dceafbcb19f6f3c8d.css integrity="sha256-9xaonkCwHwMxRu5AJJcWWsW8+JNZSAlNzq+8sZ9vPI0="><script defer src=/specifications/en.search.min.2406e4b270b2d228c64e4ad6c97237e83dde18ee0a629a54d106b00d85efd336.js integrity="sha256-JAbksnCy0ijGTkrWyXI36D3eGO4KYppU0QawDYXv0zY="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/specifications><span>UAPI Group Specifications</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://uapi-group.org/>‚¨ÖÔ∏è Back to top</a></li><li>‚∏ª</li></ul><ul><li><span>Specs</span><ul><li><a href=https://uapi-group.org/specifications/specs/sysext/>Sysext</a></li><li><a href=https://uapi-group.org/specifications/specs/boot_loader_specification/>Boot Loader Specification</a></li><li><a href=https://uapi-group.org/specifications/specs/configuration_files_specification/>Configuration Files Specification</a></li><li><a href=https://uapi-group.org/specifications/specs/discoverable_disk_image/>Discoverable Disk Image</a></li><li><a href=https://uapi-group.org/specifications/specs/discoverable_partitions_specification/>Discoverable Partitions Specification</a></li><li><a href=https://uapi-group.org/specifications/specs/extension_image/>Extension Images</a></li><li><a href=https://uapi-group.org/specifications/specs/file_hierarchy_for_the_verification_of_os_artifacts/>File Hierarchy for the Verification of OS Artifacts (VOA)</a></li><li><a href=https://uapi-group.org/specifications/specs/linux_file_system_hierarchy/>Linux File System Hierarchy</a></li><li><a href=https://uapi-group.org/specifications/specs/linux_tpm_pcr_registry/ class=active>Linux TPM PCR Registry</a></li><li><a href=https://uapi-group.org/specifications/specs/unified_kernel_image/>Unified Kernel Image</a></li><li><a href=https://uapi-group.org/specifications/specs/version_format_specification/>Version Format Specification</a></li></ul></li></ul><ul><li>‚∏ª</li><li><a href=https://github.com/uapi-group/specifications target=_blank rel=noopener>Collaborate on Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/specifications/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Linux TPM PCR Registry</strong>
<label for=toc-control><img src=/specifications/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#sources>Sources</a></li></ul></nav></aside></header><article class=markdown><h1 id=-linux-tpm-pcr-registry->üîè Linux TPM PCR Registry üóíÔ∏è
<a class=anchor href=#-linux-tpm-pcr-registry->#</a></h1><p><em>TPM PCRs are a scarce resource, there are only 24 of them in typical standards compliant TPMs.
According to the
<a href=https://trustedcomputinggroup.org/resource/pc-client-specific-platform-firmware-profile-specification/>TCG PC Client Specific Platform Firmware Profile Specification | Trusted Computing Group</a>
the OS can make use of PCRs 8‚Ä¶15.
This document lists which component is using which PCR on a Linux platform
in order to minimize conflicts.</em></p><p>PCRs owned by the firmware, i.e. PCRs 0‚Äì7 are described here just for convenience.
The authoriative description is in the TCG document.</p><p>How other operating systems ‚Äî in particular Windows ‚Äî use PCRs, is out of scope of this document.</p><p>This document is informational in nature: it just describes what is, it is not intended to formally declare ‚Äúownership‚Äù of a specific PCR, but simply is supposed to reflect which PCR assignments are common in the Linux ecosystems. That said, co-opting PCR usage will likely create problems down the line, in particular if measurement logs are maintained separately. (To be more explicit: on <code>systemd</code> systems the warranty is voided if you write to the PCRs it also uses, as per the list below.)</p><p>PCR measurements most commonly serve two distinct purposes:</p><ul><li>To implement access policy on TPM sealed objects: policy can dictate that unsealing of such objects shall only be allowed if some PCRs are in a specific literal state, or in any state for which a signature by a specific key pair can be provided. For this it is essential that PCRs only contain measurements for a clearly defined set of objects, that typically is known in advance so that the PCR value can be pre-calculated (hence this is in a way a <em>forward</em>-looking use)</li><li>To permit reasoning about the boot process and runtime <em>so far</em>, for example for the purpose of remote attestation. In this case it is not that important what objects are measured as long as a record is kept in a measurement log about what it was. The PCRs are in this case used to validate that log (hence this is in a way a <em>backward</em>-looking use)</li></ul><p>In both cases it is important that data measured into the PCRs is carefully chosen. PCRs that shall be useful for policy binding should only cover data objects known in advance, and thus not contain runtime data that cannot be pre-calculated in advance. PCRs that shall be useful for backward-looking validation should only cover objects that are also written to the appropriate log for the PCR.</p><table style=width:100%;display:block;table-layout:fixed><tr><th><p style=text-align:right><strong>PCR#</strong></p></th><th><strong>Used by</strong></th><th><strong>From Location</strong></th><th><strong>Measured Objects</strong></th><th><strong>Log</strong></th><th><strong>Use Reported By</strong></th></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>0</strong></p></td><td style=background-color:#838284><code style=background-color:#838284>Firmware üíª</code></td><td>UEFI Boot Component</td><td>Core system firmware executable code</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>1</strong></p></td><td style=background-color:#838284><code style=background-color:#838284>Firmware üíª</code></td><td>UEFI Boot Component</td><td>Core system firmware data/host platform configuration; typically contains serial and model numbers</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>2</strong></p></td><td style=background-color:#838284><code style=background-color:#838284>Firmware üíª</code></td><td>UEFI Boot Component</td><td>Extended or pluggable executable code; includes option ROMs on pluggable hardware</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>3</strong></p></td><td style=background-color:#838284><code style=background-color:#838284>Firmware üíª</code></td><td>UEFI Boot Component</td><td>Extended or pluggable firmware data; includes information about pluggable hardware</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>4</strong></p></td><td style=background-color:#838284><code style=background-color:#838284>Firmware üíª</code></td><td>UEFI Boot Component</td><td>Boot loader and additional drivers; binaries and extensions loaded by the boot loader</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>5</strong></p></td><td style=background-color:#838284><code style=background-color:#838284>Firmware üíª</code></td><td>UEFI Boot Component</td><td>GPT/Partition table</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>7</strong></p></td><td style=background-color:#838284><code style=background-color:#838284>Firmware üíª</code></td><td>UEFI Boot Component</td><td>SecureBoot state</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>8</strong></p></td><td style=background-color:#aea><code style=background-color:#aea>grub üç≤</code></td><td>UEFI Boot Component</td><td>Commands and kernel command line</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>9</strong></p></td><td style=background-color:#aea><code style=background-color:#aea>grub üç≤</code></td><td>UEFI Boot Component</td><td>All files read (including kernel image)</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf></td><td style=background-color:#b399c2>Linux kernel üå∞</td><td>Kernel</td><td>All passed initrds (when the new <code>LOAD_FILE2 </code>initrd protocol is used)</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>10</strong></p></td><td style=background-color:#a3c2d4>IMA üìê</td><td>Kernel</td><td>Protection of the IMA measurement log</td><td>IMA event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>11</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-stub üöÄ</code></td><td>UEFI Stub</td><td>All components of unified kernel images (UKIs)</td><td>UEFI TPM event log</td><td>in EFI variable <code>StubPcrKernelImage</code></td></tr><tr><td style=background-color:#fff3bf></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-pcrphase üöÄ</code></td><td>Userspace</td><td>Boot phase strings, indicating various milestones of the boot process</td><td>Journal (for now)</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>12</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-stub üöÄ</code></td><td>UEFI Stub</td><td>Kernel command line, system credentials and system configuration images</td><td>UEFI TPM event log</td><td>in EFI variable <code>StubPcrKernelParameters</code></td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>13</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-stub üöÄ</code></td><td>UEFI Stub</td><td>All system extension images for the initrd</td><td>UEFI TPM event log</td><td>in EFI variable <code>StubPcrInitRDSysExts</code></td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>14</strong></p></td><td style=background-color:#f5d97d><code style=background-color:#f5d97d>shim üîë</code></td><td>UEFI Boot Component</td><td>‚ÄúMOK‚Äù certificates and hashes</td><td>UEFI TPM event log</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf><p style=text-align:right><strong>15</strong></p></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-cryptsetup@.service üöÄ</code></td><td>Userspace</td><td>Root file system volume encryption key</td><td>Journal (for now)</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-pcrmachine.service üöÄ</code></td><td>Userspace</td><td>Machine ID (<code>/etc/machine-id</code>)</td><td>Journal (for now)</td><td>n/a</td></tr><tr><td style=background-color:#fff3bf></td><td style=background-color:#e5c8e6><code style=background-color:#e5c8e6>systemd-pcrfs@.service üöÄ</code></td><td>Userspace</td><td>File system mount point, UUID, label, partition UUID label of root file system and <code>/var/</code></td><td>Journal (for now)</td><td>n/a</td></tr></table><p>PCR 0 changes on firmware updates; PCR 1 changes on basic hardware/CPU/RAM replacements.</p><p>PCR 4 changes on boot loader updates.
The shim project will measure the PE binary it chain loads into this PCR.
If the Linux kernel is invoked as UEFI PE binary, it is measured here, too.
<a href=https://www.freedesktop.org/software/systemd/man/systemd-stub.html>systemd-stub</a>
measures system extension images read from the ESP here too
(see
<a href=https://www.freedesktop.org/software/systemd/man/systemd-sysext.html>systemd-sysext</a>
and
<a href=/specifications/specs/extension_image/>Extension Images</a>).</p><p>PCR 5 changes when partitions are added, modified, or removed.</p><p>PCR 7 changes when UEFI SecureBoot mode is enabled/disabled, or firmware certificates (PK, KEK, db, dbx, ‚Ä¶) are updated.
The shim project will measure most of its (non-MOK) certificates and SBAT data into this PCR.</p><p>PCR 11 and 15 as shown in the list above are used by multiple components of systemd.
These are not conflicting uses;
the involved components are properly ordered to cooperatively guarantee predictable behaviour.</p><p><a href=https://www.freedesktop.org/software/systemd/man/systemd-stub.html>systemd-stub</a>
measures the ELF kernel image, embedded initrd and other payload of the PE image into PCR 11.
Unlike PCR 4 (where the same data should be measured too), those values should be easy to pre-calculate,
as they only reflect the static parts of the PE binary.
<a href=https://www.freedesktop.org/software/systemd/man/systemd-pcrphase.service.html>systemd-pcrphase.service</a>
measures boot phase strings into this PCR at various milestones of the boot process.
Use PCR 11 to bind TPM policies to a specific kernel image, possibly with an embedded initrd,
and to a specific boot phase.</p><p><a href=https://www.freedesktop.org/software/systemd/man/systemd-boot.html>systemd-boot</a>
measures the kernel command line into PCR 12.
<a href=https://www.freedesktop.org/software/systemd/man/systemd-stub.html>systemd-stub</a>
measures any manually specified kernel command line (i.e. a kernel command line that overrides the one embedded in the UKI)
and loaded credentials into this PCR.
This means that if <code>systemd-boot</code> and <code>systemd-stub</code> are used together, the command line might be measured twice.</p><p><a href=https://www.freedesktop.org/software/systemd/man/systemd-stub.html>systemd-stub</a>
measures any
<a href=/specifications/specs/extension_image/>Extension Images</a>
it passes to the booted kernel into PCR 13.</p><p><a href=https://www.freedesktop.org/software/systemd/man/systemd-cryptsetup.html>systemd-cryptsetup</a>
optionally measures the volume key of activated LUKS volumes into this PCR.
<a href=https://www.freedesktop.org/software/systemd/man/systemd-pcrmachine.service.html>systemd-pcrmachine.service</a>
measures the
<a href=https://www.freedesktop.org/software/systemd/man/machine-id.html>machine-id</a>
into this PCR.
<a href=https://www.freedesktop.org/software/systemd/man/systemd-pcrfs@.service.html>systemd-pcrfs@.service</a>
measures mount points, file system UUIDs, labels, partion UUIDs
of the root and <code>/var/</code> filesystems into this PCR.</p><h2 id=sources>Sources
<a class=anchor href=#sources>#</a></h2><ul><li><a href="https://www.freedesktop.org/software/systemd/man/systemd-cryptenroll.html#--tpm2-pcrs=PCR">systemd-cryptenroll(1)</a></li><li><a href=https://trustedcomputinggroup.org/resource/pc-client-specific-platform-firmware-profile-specification/>TCG PC Client Specific Platform Firmware Profile Specification</a></li><li><a href=https://github.com/rhboot/shim/blob/main/README.tpm>shim&rsquo;s README.tpm</a></li><li><a href=https://www.gnu.org/software/grub/manual/grub/html_node/Measured-Boot.html>Measured Boot - GNU GRUB Manual 2.06</a></li><li><a href=https://sourceforge.net/p/linux-ima/wiki/Home/>Integrity Measurement Architecture (IMA)</a></li><li><a href=https://github.com/tianocore-docs/edk2-TrustedBootChain/blob/main/4_Other_Trusted_Boot_Chains.md>edk2-TrustedBootChain/4_Other_Trusted_Boot_Chains.md</a></li><li><a href=https://wiki.archlinux.org/title/Trusted_Platform_Module#Accessing_PCR_registers>Trusted Platform Module - ArchWiki</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/uapi-group/specifications/edit/main/specs/linux_tpm_pcr_registry.md target=_blank rel=noopener><img src=/specifications/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#sources>Sources</a></li></ul></nav></div></aside></main></body></html>